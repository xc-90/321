<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='host.css') }}">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Host Game - Chemistry Game</title>
</head>
<body>
    
    <main class="container">
        <h2>Host a Game</h2>
        <p class="warning-text">THIS IS ONLY MEANT FOR TEACHERS</p>
        <button id="create-game-btn">Create Game</button>
        <p id="status-message"></p>
    </main>
    
    <script src="https://cdn.socket.io/4.8.1/socket.io.min.js"></script>
    <script>
        const socket = io();
        const createGameBtn = document.getElementById('create-game-btn');
        const statusMsg = document.getElementById('status-message');

        socket.on('connect', () => {
            console.log('Connected to server');
            statusMsg.textContent = '';
        });

        socket.on('connect_error', (error) => {
            console.error('Connection error:', error);
            statusMsg.textContent = 'Connection error. Please refresh the page';
            statusMsg.style.color = '#ff4d4d';
            createGameBtn.disabled = false;
            createGameBtn.textContent = 'Create Game';
        });

        createGameBtn.addEventListener('click', () => {
            socket.emit('host_game');
            createGameBtn.disabled = true;
            createGameBtn.textContent = 'Creating game...';
            statusMsg.textContent = 'Creating your game...';
            statusMsg.style.color = '#aaaaaa';
        });

        socket.on('game_created', (data) => {
            const { game_code, host_token } = data;
            console.log('Game created:', game_code);
            statusMsg.textContent = 'Game created! Redirecting...';
            statusMsg.style.color = '#4dff88';
            
            localStorage.setItem(`host_token_${game_code}`, host_token);
            
            window.location.href = `/host/${game_code}`;
        });

        socket.on('error', (data) => {
            alert(data.message || 'An error occurred');
            createGameBtn.disabled = false;
            createGameBtn.textContent = 'Create Game';
            statusMsg.textContent = '';
        });
    </script>

</body>
</html>